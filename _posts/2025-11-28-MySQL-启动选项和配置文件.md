---
title: MySQL - 启动选项和配置文件
description: 
author: zhang
date: 2025-11-28 11:33:00 +0800
categories: [MySQL, MySQL是怎样运行的 - 笔记]
tags: [MySQL, Reading Notes]
pin: false
math: true
mermaid: true
---
## 启动选项
服务端启动选项

| 参数名  |          含义           |
|--------|------------------------|
| `--skip_networking` | 禁止各客户端使用TCP/IP网络进行通信 |
| `--default-storage-engine` | 设置默认存储引擎 |
| `--defaults-extra-file` | 额外的配置文件路径 |
| `--defaults-file` | 不再去找固定的配置文件路径，只加载该指定配置文件 |

举例：
```shell
mysqld --default-storage-engine=MyISAM
```

## 配置文件

***命令行中的启动选项优先级大于配置文件里的选项。***

### Windows操作系统的配置文件（了解） 

在Windows操作系统中，MySQL会按照下列路径来寻找配置文件：

|路径名	| 备注 |
|------|-----|
| %WINDIR%\my.ini， %WINDIR%\my.cnf	|`%WINDIR%`指的是机器上Windows目录的位置，通常是`C:\WINDOWS`|
|C:\my.ini， C:\my.cnf||
|BASEDIR\my.ini， BASEDIR\my.cnf	|`BASEDIR`指的是`MySQL`安装目录的路径|
|defaults-extra-file|	命令行指定的额外配置文件路径|
|%APPDATA%\MySQL\.mylogin.cnf|	登录路径选项（仅限客户端）|

## 类Unix操作系统中的配置文件

在类UNIX操作系统中，MySQL会按照下列路径来寻找配置文件：

| 路径名               | 备注                               |
|----------------------|------------------------------------|
| /etc/my.cnf          |  可以包含**服务端和客户端选项**       |
| /etc/mysql/my.cnf    |   可以包含**服务端和客户端选项**      |
| SYSCONFDIR/my.cnf    |  可以包含**服务端和客户端选项**    |
| $MYSQL_HOME/my.cnf   | 特定于服务器的选项（**仅限服务器**）, `MYSQL_HOME` 默认是`MySQL`的安装目录   |
| defaults-extra-file  | 命令行指定的额外配置文件路径（可以包含**服务端和客户端选项**）|
| ~/.my.cnf            | 用户特定选项(**服务端和客户端选项**) |
| ~/.mylogin.cnf       | 用户特定的登录路径选项（**仅限客户端**） |

## 配置文件的内容

配置文件中的启动选项被划分为若干个组:

```txt
[server]
(具体的启动选项...)

[mysqld]
(具体的启动选项...)

[mysqld_safe]
(具体的启动选项...)

[client]
(具体的启动选项...)

[mysql]
(具体的启动选项...)

[mysqladmin]
(具体的启动选项...)
```

组和命令的对应关系：

| 启动命令 / 程序         | 会读取的 group（段）                                   | 说明 |
|-------------------------|--------------------------------------------------------|------|
| **mysqld**                  | [mysqld], [server], [mysqld-版本号]                   | 核心服务端进程（数据库实例） |
| mysqld_safe             | [mysqld], [server], [mysqld_safe]                     | wrapper，负责启动 mysqld |
| **mysql**                   | [client], [mysql]                                      | MySQL 命令行客户端 |
| **mysqldump**               | [client], [mysqldump]                                  | 数据导出工具 |
| **mysqladmin**              | [client], [mysqladmin]                                 | 管理工具（shutdown、flush 等） |
| mysqlcheck              | [client], [mysqlcheck]                                 | 表检查工具 |
| mysqlbinlog             | [client], [mysqlbinlog]                                | binlog 解析工具 |
| mysqlshow               | [client], [mysqlshow]                                  | 展示库表信息 |
| mysqlimport             | [client], [mysqlimport]                                | 导入工具 |
| mysqlslap               | [client], [mysqlslap]                                  | 压测工具 |

## 系统变量

MySQL服务端运行过程有许多影响程序行为的变量，被称为`MySQL系统变量`。
(系统变量的单词之间必须使用下划线_连接起来)

### 查看系统变量
我们可以使用下列命令查看MySQL服务器程序支持的系统变量以及它们的当前值：`SHOW VARIABLES [LIKE 匹配的模式];`

```shell
mysql> SHOW VARIABLES LIKE 'default_storage_engine';
+------------------------+--------+
| Variable_name          | Value  |
+------------------------+--------+
| default_storage_engine | InnoDB |
+------------------------+--------+
1 row in set (0.01 sec)

mysql> SHOW VARIABLES like 'max_connections';
+-----------------+-------+
| Variable_name   | Value |
+-----------------+-------+
| max_connections | 151   |
+-----------------+-------+
1 row in set (0.00 sec)
```

### 服务器程序运行过程中设置

对于大部分系统变量来说，它们的值可以在服务器程序运行过程中进行动态修改而无需停止并重启服务器。

#### 1. 设置不同作用范围的系统变量

- `GLOBAL`：全局变量，影响服务器的整体操作。

- `SESSION`：会话变量，影响某个客户端连接的操作。（注：SESSION有个别名叫LOCAL）

在服务器启动时，会将每个全局变量初始化为其默认值（可以通过命令行或选项文件中指定的选项更改这些默认值）。
在客户端连接服务端时，服务器会维护一组会话变量，会话变量在连接时使用相应全局变量的当前值初始化。

设置系统变量: `SET [GLOBAL|SESSION] 系统变量名 = 值;`或者`SET [@@(GLOBAL|SESSION).]var_name = XXX;`

举例：
设置全局的default_storage_engine
```shell
语句一：SET GLOBAL default_storage_engine = MyISAM;
语句二：SET @@GLOBAL.default_storage_engine = MyISAM;
```

设置会话级别的default_storage_engine
```shell
语句一：SET SESSION default_storage_engine = MyISAM;
语句二：SET @@SESSION.default_storage_engine = MyISAM;
语句三：SET default_storage_engine = MyISAM; （不指定范围的话， 默认范围是 SESSION）
```

#### 2. 查看不同范围的系统变量

```shell
SHOW [GLOBAL|SESSION] VARIABLES [LIKE 匹配的模式];
```

#### 3. 常用的系统变量（了解）

- 连接与安全相关：

| 变量                    | 默认值                                          | 说明                 |
| --------------------- | -------------------------------------------- | ------------------ |
| `port`                | 3306                                         | MySQL 服务端端口        |
| `bind_address`        | `0.0.0.0`                                    | 绑定 IP，默认监听所有网卡     |
| `max_connections`     | 151                                          | 最大客户端连接数           |
| `wait_timeout`        | 28800                                        | 非交互连接的超时时间（秒）      |
| `interactive_timeout` | 28800                                        | 交互连接超时（秒）          |
| `skip_name_resolve`   | OFF                                          | 是否禁用 DNS 解析，加快连接速度 |
| `sql_mode`            | `STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION` | SQL 模式，控制 SQL 行为   |

- 存储引擎与表相关

| 变量                        | 默认值                | 说明                |
| ------------------------- | ------------------ | ----------------- |
| `default_storage_engine`  | InnoDB             | 默认存储引擎            |
| `innodb_file_per_table`   | ON                 | 每个表单独存储数据文件       |
| `innodb_buffer_pool_size` | 128MB              | InnoDB 缓冲池大小，影响性能 |
| `innodb_log_file_size`    | 48MB               | redo log 文件大小     |
| `character_set_server`    | utf8mb4            | 默认字符集             |
| `collation_server`        | utf8mb4_0900_ai_ci | 默认排序规则            |

- 查询与性能相关

| 变量                    | 默认值         | 说明              |
| --------------------- | ----------- | --------------- |
| `query_cache_size`    | 0 (8.0 已弃用) | 查询缓存大小          |
| `tmp_table_size`      | 16MB        | 内存临时表大小         |
| `max_heap_table_size` | 16MB        | 内存表最大尺寸         |
| `slow_query_log`      | OFF         | 是否开启慢查询日志       |
| `long_query_time`     | 10          | 慢查询阈值（秒）        |
| `log_bin`             | OFF         | 是否开启二进制日志（主从复制） |

- 日志相关

| 变量                    | 默认值                 | 说明         |
| --------------------- | ------------------- | ---------- |
| `general_log`         | OFF                 | 是否开启通用查询日志 |
| `general_log_file`    | `HOSTname.log`      | 通用日志文件路径   |
| `slow_query_log_file` | `HOSTname-slow.log` | 慢查询日志文件路径  |
| `log_error`           | `hostname.err`      | 错误日志文件路径   |

- 内存与缓存相关

| 变量                        | 默认值   | 说明                 |
| ------------------------- | ----- | ------------------ |
| `key_buffer_size`         | 8MB   | MyISAM 索引缓存        |
| `innodb_buffer_pool_size` | 128MB | InnoDB 缓冲池         |
| `innodb_log_buffer_size`  | 16MB  | InnoDB redo log 缓冲 |
| `sort_buffer_size`        | 256KB | 排序操作缓冲             |
| `read_buffer_size`        | 128KB | 顺序扫描缓冲             |
| `read_rnd_buffer_size`    | 256KB | 随机读取缓冲             |

- 时间与时区相关

| 变量                  | 默认值    | 说明         |
| ------------------- | ------ | ---------- |
| `time_zone`         | SYSTEM | MySQL 当前时区 |
| `system_time_zone`  | 系统默认   | 系统时区       |
| `default_time_zone` | SYSTEM | 默认时间戳      |

